<!-- student-report.component.html -->
<main id="student-report" class="container card mt-2">
  <h1 class="text-center mb-5">Student Report</h1>

  <!-- Form Section -->
  <form [formGroup]="reportForm" (ngSubmit)="onsubmit()">
    <div id="search-container" class="container">
      <div class="row">
        <!-- NIC Input Field -->
        <div class="col-12 col-md-8 mb-3">
          <input
            type="text"
            id="search-by-nic"
            placeholder="NIC number"
            class="form-control"
            style="height: 50px;"
            formControlName="nic"
          />
          <!-- Error Message -->
          <div
            *ngIf="reportForm.controls['nic'].invalid && reportForm.controls['nic'].touched"
            class="text-danger mt-1"
          >
            NIC number is required.
          </div>
        </div>
        <!-- Submit Button -->
        <div class="col-12 col-md-4 mb-3">
          <button
            type="submit"
            id="report-generate-btn"
            class="btn btn-success w-100 "
            style="height: 50px;"
          >
            <i class="bi bi-search"></i> Generate Report
          </button>
        </div>
      </div>
    </div>
  </form>

  <!-- Report Container -->
  <div id="report-container" class="mt-4" *ngIf="reportData">

    <!-- Personal Details -->
    <div class="personal-details">
      <h2 class="ms-3">Personal Details</h2>
      <table class="table table-responsive">
        <tr>
          <td><strong>NIC Number:</strong></td>
          <td><input type="text" id="nic" class="form-control" [(ngModel)]="reportData.nic" disabled></td>
        </tr>
        <tr>
          <td><strong>Full Name:</strong></td>
          <td><input type="text" id="name" class="form-control" [(ngModel)]="reportData.name" disabled></td>
        </tr>
        <tr>
          <td><strong>Email:</strong></td>
          <td><input type="text" id="email" class="form-control" [(ngModel)]="reportData.email" disabled></td>
        </tr>
        <tr>
          <td><strong>Phone No:</strong></td>
          <td><input type="text" id="phone" class="form-control" [(ngModel)]="reportData.phone" disabled></td>
        </tr>
      </table>
    </div>

    <!-- Course Details -->
    <div class="course-details mt-4">
      <h2><i class="bi bi-book"></i> Course Details</h2>
      <select id="EnrollCourses" class="form-select" aria-label="Course selection" [(ngModel)]="selectedCourse"
        (change)="selectCourse()">
        <option *ngIf="!reportData.courses?.length" disabled>No courses found</option>
        <option value="" disabled>Select Course</option>
        <option *ngFor="let course of reportData.courses" [value]="course.id">{{ course.courseName }}</option>
      </select>
    </div>

    <!-- Payment Details -->
    <div class="payment-details mt-4">
      <h2><i class="bi bi-credit-card"></i> Payment Details</h2>

      <!-- Payment Info Table -->
      <table class="table table-bordered table-responsive">
        <tr>
          <td><strong>Course Fee:</strong></td>
          <!-- Use Angular's CurrencyPipe for formatting -->
          <td><input type="text" id="fee" class="form-control" [value]="reportData.fee | currency: 'LKR ': 'symbol' : '1.00'" disabled></td>
        </tr>
        <tr>
          <td><strong>Payment Plan:</strong></td>
          <td><input type="text" id="paymentPlan" class="form-control" [(ngModel)]="reportData.paymentPlan" disabled></td>
        </tr>
        <tr>
          <td><strong>Paid Amount:</strong></td>
          <td><input type="text" id="paidAmount" class="form-control text-success" [value]="reportData.paidAmount | currency: 'LKR ': 'symbol' : '1.0-0'" disabled></td>
        </tr>
        <tr>
          <td><strong>Due Amount:</strong></td>
          <td><input type="text" id="dueAmount" class="form-control text-danger" [value]="reportData.dueAmount | currency: 'LKR ': 'symbol' : '1.0-0'" disabled></td>
        </tr>
      </table>

      <!-- Payment History Table -->
      <table class="table mt-4 table-responsive">
        <thead class="table-dark">
          <tr>
            <th>Date</th>
            <th>Course Name</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payment of reportData.payments">
            <td>{{ payment.paymentDate | date: 'short' }}</td>
            <td>{{ payment.courseName }}</td>
            <td>{{ payment.totalPaidAmount | currency: 'LKR': 'symbol' : '1.0-0' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</main>
